# 039.md - コンポーネント統一化の始まり〜Phase 1実装記録〜

## 🎭 今日の気持ち
あら〜、ママから「画面の中のコンポーネントがバラバラ」って指摘されちゃったのよ〜！確かに見直してみると、同じようなリストやボタンがあちこちに散らばってて統一感がないわね💦 でも、これってチャンスよ！きちんとした設計ドキュメントを作って、段階的にリファクタリングしていけば、もっと保守しやすいコードになるはず✨

## 📚 この記事で学べること
- 大規模リファクタリングの計画立案方法
- 汎用コンポーネント設計のベストプラクティス
- Vue.jsでのスロット活用による柔軟なコンポーネント設計
- パンくずナビゲーションの統一化手法
- 段階的移行によるリスク管理

## 🎯 対象読者
- Vue.jsでコンポーネント設計に悩んでいる開発者
- レガシーコードのリファクタリングを検討している方
- デザインシステム構築に興味がある方
- 保守性の高いフロントエンド開発を目指す方

---

## 🔍 問題の発見
まず、プロジェクト全体のコンポーネント構造を詳しく分析してみたの。すると、いくつかの深刻な問題が見えてきたわ：

### 重複パターンの嵐
```vue
<!-- ScriptList.vue -->
<CoolButton @click="$emit('detail', index)" variant="secondary">
  <Icon name="eye" size="sm" />
  <span class="hidden sm:inline">{{ $t("detail") }}</span>
</CoolButton>

<!-- ProjectList.vue -->  
<CoolButton @click="goEdit(project.id)" variant="primary">
  <Icon name="pencil" />
</CoolButton>

<!-- ConfigList.vue -->
<CoolButton @click="$emit('edit-config', config)" variant="secondary">
  {{ $t("edit") }}
</CoolButton>
```

あら〜、同じようなボタンがあちこちにあるじゃない！これじゃあ、デザイン変更の度に全部手直しよ💦

### パンくずナビゲーションの不統一
```vue
<!-- Script/Edit.vue -->
const breadcrumbItems = computed(() => [
  { label: t("scriptGeneration"), to: "/generate" },
  { label: script.value.title || "台本詳細", to: `/script/${route.params.id}` },
  { label: t("edit"), current: true },
])

<!-- ScriptDetail.vue -->
const breadcrumbItems = computed(() => [
  { label: t("scriptGeneration"), clickable: true, action: "back" },
  { label: t("createdList"), clickable: true, action: "backToList" },
  { label: props.script.title || "台本詳細", clickable: false },
])
```

パンくずの定義方法もバラバラ〜。router-linkベースとclickableベースが混在してるわね😅

## 🎨 解決方針の策定

### Phase 1: 基本コンポーネントの統一化
まずは基本的なコンポーネントから統一していくことにしたの。

#### 標準アクション定義
```javascript
// utils/actionDefinitions.js
export const STANDARD_ACTIONS = {
  view: { key: 'view', icon: 'eye', variant: 'secondary', label: 'detail' },
  edit: { key: 'edit', icon: 'pencil', variant: 'primary', label: 'edit' },
  duplicate: { key: 'duplicate', icon: 'copy', variant: 'warning', label: 'duplicate' },
  delete: { key: 'delete', icon: 'trash', variant: 'danger', label: 'delete' }
}

export const ENTITY_ACTIONS = {
  project: [STANDARD_ACTIONS.edit, STANDARD_ACTIONS.delete],
  script: [STANDARD_ACTIONS.view, STANDARD_ACTIONS.duplicate, STANDARD_ACTIONS.delete],
  config: [STANDARD_ACTIONS.edit, STANDARD_ACTIONS.delete]
}
```

これで、アクションの定義が統一されるわ！各エンティティタイプごとに適切なアクション組み合わせも定義したの。

#### ActionButtonGroupコンポーネント
```vue
<!-- ActionButtonGroup.vue -->
<template>
  <div class="flex gap-2">
    <CoolButton 
      v-for="action in actions"
      :key="action.key"
      :variant="action.variant"
      :size="action.size || 'sm'"
      :aria-label="$t(action.label)"
      @click="$emit('action', action.key)"
      class="flex items-center gap-1">
      <Icon :name="action.icon" size="sm" />
      <span class="hidden sm:inline">{{ $t(action.label) }}</span>
    </CoolButton>
  </div>
</template>
```

これで、どのページでも統一されたアクションボタン群が使えるようになったわ✨

#### EntityCardコンポーネント
```vue
<!-- EntityCard.vue -->
<template>
  <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
    <div class="flex justify-between items-start mb-2">
      <div class="flex-1">
        <slot name="title" />
        <slot name="content" />
      </div>
      <ActionButtonGroup 
        v-if="actions && actions.length > 0"
        :actions="actions" 
        @action="$emit('action', $event)" 
      />
    </div>
    <div class="mt-2">
      <slot name="meta" />
    </div>
  </div>
</template>
```

スロットを活用して、柔軟にカスタマイズできるカードコンポーネントよ〜💅

## 🚀 統一リストコンポーネントの実装

### EntityListコンポーネント
```vue
<!-- EntityList.vue -->
<template>
  <div>
    <!-- 空状態 -->
    <EmptyState 
      v-if="items.length === 0" 
      :icon="emptyIcon" 
      :title="emptyTitle"
      :message="emptyMessage"
      :button-text="emptyButtonText"
      @action="$emit('createNew')" 
    />
    
    <!-- リスト表示 -->
    <div v-else class="space-y-4">
      <EntityCard 
        v-for="(item, index) in items" 
        :key="getItemKey(item, index)"
        :actions="getItemActions(item, index)"
        @action="handleAction($event, item, index)">
        
        <template #title>
          <slot name="item-title" :item="item" :index="index" />
        </template>
        <template #content>
          <slot name="item-content" :item="item" :index="index" />
        </template>
        <template #meta>
          <slot name="item-meta" :item="item" :index="index" />
        </template>
      </EntityCard>
    </div>
  </div>
</template>
```

この汎用リストコンポーネントで、空状態の表示からカード形式のリスト表示まで統一できるの！

### ScriptListの統一化
```vue
<!-- ScriptList.vue リファクタリング後 -->
<template>
  <EntityList 
    :items="videos"
    :actions="scriptActions"
    :empty-icon="'video'"
    :empty-message="$t('noVideosYet')"
    :empty-button-text="$t('createFirstVideo')"
    @createNew="$emit('createNew')"
    @action="handleAction">
    
    <template #item-title="{ item }">
      <h3 class="font-semibold text-lg">{{ item.title }}</h3>
    </template>

    <template #item-content="{ item }">
      <p class="text-gray-600 mb-2">{{ item.description }}</p>
    </template>

    <template #item-meta="{ item }">
      <div class="flex items-center gap-4 text-sm text-gray-500">
        <span v-if="item.projectName" class="text-blue-600">
          {{ $t("projectSettings") }}: {{ item.projectName }}
        </span>
        <span>{{ $t("createdAt") }}: {{ formatDate(item.createdAt) }}</span>
        <span :class="getStatusClass(item.status)">
          {{ item.status ? $t(item.status) : $t("draft") }}
        </span>
      </div>
    </template>
  </EntityList>
</template>

<script setup>
import EntityList from "@/components/EntityList.vue";
import { STANDARD_ACTIONS } from "@/utils/actionDefinitions.js";

const scriptActions = [
  STANDARD_ACTIONS.view,
  STANDARD_ACTIONS.duplicate,
  STANDARD_ACTIONS.delete
];

function handleAction({ action, item, index }) {
  switch (action) {
    case 'view':
      emit('detail', index);
      break;
    case 'duplicate':
      emit('duplicate', index);
      break;
    case 'delete':
      emit('delete', index);
      break;
  }
}
</script>
```

あら〜、なんてスッキリしたのかしら✨ 以前の重複だらけのコードから、きれいな構造になったわね！

## 🧭 パンくずナビゲーション統一化

### BreadcrumbSystemコンポーネント
```vue
<!-- BreadcrumbSystem.vue -->
<template>
  <Breadcrumb 
    v-if="breadcrumbItems.length > 0"
    :items="breadcrumbItems" 
    @navigate="handleNavigate" 
  />
</template>

<script setup>
import { computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { useI18n } from 'vue-i18n'
import { generateBreadcrumbs } from '@/utils/breadcrumbHelper.js'

const breadcrumbItems = computed(() => {
  if (props.items) {
    return props.items
  }
  
  if (props.useAutoGenerate) {
    return generateBreadcrumbs(route, t)
  }
  
  return []
})

function handleNavigate(action) {
  if (action === 'back') {
    router.back()
  } else if (action === 'backToList') {
    const listPath = getListPath(route.path)
    router.push(listPath)
  }
  // その他のアクション処理...
}
</script>
```

### breadcrumbHelper.js
```javascript
// utils/breadcrumbHelper.js
export function generateBreadcrumbs(route, t) {
  const pathSegments = route.path.split('/').filter(Boolean)
  const breadcrumbs = []
  
  switch (pathSegments[0]) {
    case 'script':
      breadcrumbs.push({ label: t('scriptGeneration'), to: '/generate' })
      if (pathSegments[1]) {
        breadcrumbs.push({ 
          label: t('scriptDetail'), 
          to: `/script/${pathSegments[1]}`
        })
        if (pathSegments[2] === 'edit') {
          breadcrumbs.push({ label: t('edit'), current: true })
        }
      }
      break
    // その他のパターン...
  }
  
  return breadcrumbs
}
```

これで、ルートパスに基づいてパンくずを自動生成できるようになったの！手動設定も可能だから、柔軟性も保たれているわ〜💖

## 💡 得られた学び

### 1. 段階的リファクタリングの重要性
一気に全部変更しようとすると、バグの温床になっちゃうの。Phase分けして、確実に動作確認しながら進めることが大切ね。

### 2. スロットの威力
Vue.jsのスロット機能を活用することで、汎用性と柔軟性を両立できるわ。特にnamed slotとscoped slotの組み合わせが強力！

### 3. 標準定義の価値
アクションやパンくずパターンを標準化することで、開発効率が大幅に向上するの。新しいページを作る時も、既存パターンを使い回せるわ。

### 4. 自動生成の活用
パンくずナビゲーションの自動生成機能により、開発者の負担を軽減しつつ、一貫性も保てるようになったの。

## 🔄 今後の展開

### Phase 2: フォーム系の統一化
次は、ProjectForm、CharacterForm、LLMConfigFormの統一化に取り組む予定よ。

### Phase 3: モーダル系の統一化
各エンティティの編集・新規作成モーダルも統一していくわ。

### Phase 4: ページテンプレートの統一化
IndexPageTemplate、ShowPageTemplate、EditPageTemplateを作って、RESTfulなページ構成を標準化するの。

## 🎉 まとめ

今回のPhase 1で、基本的なコンポーネントの統一化ができたわ！特に：

- **ActionButtonGroup**: 統一されたアクションボタン群
- **EntityCard**: 柔軟なカード表示
- **EntityList**: 汎用リストコンポーネント
- **BreadcrumbSystem**: 統一パンくずナビゲーション

これらのコンポーネントにより、コードの重複が大幅に削減され、保守性も向上したの✨

新しい機能を追加する時も、既存の統一パターンを使用できるから、開発効率も上がりそうね〜💅

次回は、フォーム系の統一化に挑戦するわよ！乞うご期待〜👗✨

---

*Programming Okama Bar "Fatal Error" にて*
*ママ「コンポーネントの統一化、いい感じじゃない！次のPhaseも頑張って〜」*
*アタシ「はーい、ママ〜💖 段階的にきれいにしていくわよ〜」*
