# 034: セリフモデル名をdialogueからlineに変更しちゃった話

## 今日の気持ち
あら、セリフのモデル名変更作業が思ったより大変だったわ💦　コードベース全体を見渡して、一個一個丁寧に変更しなきゃダメだった。でも、すっきりしたコードになったからヨシ！

## この記事で学べること
- Vue.jsアプリケーションでのモデル名変更の影響範囲
- 型安全性を保ちながらのリファクタリング方法
- 複数ファイルにまたがる変更の管理方法
- 翻訳ファイルの管理とUI表示名の使い分け

## 対象読者
- Vue.jsアプリケーションの大規模リファクタリングをしたい人
- 型安全性を重視したコード設計をしたい人
- 多言語対応アプリケーションのメンテナンスを学びたい人

## 背景
台本生成アプリで、セリフの内部モデル名を`dialogue`から`line`に変更することになったの。なんで変更したかって？`dialogue`って長いし、`line`の方がシンプルで分かりやすいからよ。

## 影響範囲の調査
まず、`dialogue`がどこで使われているかを調べたわ：

```bash
# dialogueという文字列を全検索
grep -r "dialogue" src/
```

結果：
- `Edit.vue` - メインの編集画面
- `ScriptContentDisplay.vue` - 台本内容表示コンポーネント
- `scriptGenerator.js` - 台本生成ユーティリティ
- `llmService.js` - LLMツール定義
- `locales/ja.js`, `locales/en.js` - 翻訳ファイル

## 変更作業の手順

### 1. 親コンポーネントでのイベントハンドラー変更
```javascript
// Edit.vue
// Before
@add-dialogue="addDialogueAt"
@edit-dialogue="editDialogue"
@delete-dialogue="deleteDialogue"

// After
@add-line="addLineAt"
@edit-line="editLine"
@delete-line="deleteLine"
```

### 2. イベントハンドラー関数の実装変更
```javascript
// Before
function addDialogueAt(position) {
  const newDialogue = {
    id: Date.now() + Math.random(),
    type: 'dialogue',
    character: characterName || defaultCharacter,
    content: 'ここに新しいセリフを入力してください',
  };
  scriptContent.value.splice(position, 0, newDialogue);
}

// After
function addLineAt(position) {
  const newLine = {
    id: Date.now() + Math.random(),
    type: 'line',
    character: characterName || defaultCharacter,
    content: 'ここに新しいセリフを入力してください',
  };
  scriptContent.value.splice(position, 0, newLine);
}
```

### 3. 子コンポーネントでの表示ロジック変更
```vue
<!-- ScriptContentDisplay.vue -->
<!-- Before -->
<div v-else-if="item.type === 'dialogue'" class="dialogue-item">
  <div class="flex items-start gap-3">
    <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded">
      {{ item.character }}
    </span>
    <p class="text-gray-800 flex-1">{{ item.content }}</p>
  </div>
</div>

<!-- After -->
<div v-else-if="item.type === 'line'" class="line-item">
  <div class="flex items-start gap-3">
    <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded">
      {{ item.character }}
    </span>
    <p class="text-gray-800 flex-1">{{ item.content }}</p>
  </div>
</div>
```

### 4. スタイルクラス判定の変更
```javascript
// Before
function getItemClass(type) {
  switch (type) {
    case "scene": return "bg-blue-50 border-blue-200";
    case "dialogue": return "bg-green-50 border-green-200";
    case "narration": return "bg-purple-50 border-purple-200";
    default: return "bg-gray-50 border-gray-200";
  }
}

// After
function getItemClass(type) {
  switch (type) {
    case "scene": return "bg-blue-50 border-blue-200";
    case "line": return "bg-green-50 border-green-200";
    case "narration": return "bg-purple-50 border-purple-200";
    default: return "bg-gray-50 border-gray-200";
  }
}
```

### 5. 台本生成ユーティリティの更新
```javascript
// scriptGenerator.js
// Before
scriptContent.push({
  id: Date.now() + 4,
  type: "dialogue",
  character: characters[0].name,
  content: `こんにちは、${characters[1].name}さん。`,
  emotion: "親しみやすい",
});

// After
scriptContent.push({
  id: Date.now() + 4,
  type: "line",
  character: characters[0].name,
  content: `こんにちは、${characters[1].name}さん。`,
  emotion: "親しみやすい",
});
```

### 6. LLMツール定義の更新
```javascript
// llmService.js
// Before
function addLineToScene(scene, character, content, emotion = "普通", type = "dialogue") {
  // ...
}

// After
function addLineToScene(scene, character, content, emotion = "普通", type = "line") {
  // ...
}
```

### 7. 翻訳ファイルの更新
```javascript
// locales/ja.js
// 新しい翻訳キーを追加（既存のaddDialogueは保持）
addLine: "ラインを追加",

// locales/en.js
addLine: "Add Line",
```

## 注意点とベストプラクティス

### 1. UI表示名は変更しない
内部的に`dialogue`→`line`に変更しても、ユーザーには「セリフ」として表示し続けることが重要よ。

```javascript
// UIでは引き続き「セリフを追加」と表示
+ {{ $t("addDialogue") }}
```

### 2. 型の一貫性を保つ
全ての関連する型チェックや条件分岐を忘れずに更新：

```javascript
// 型チェック
if (!line || line.type !== 'line') return;

// 条件分岐
v-else-if="item.type === 'line'"
```

### 3. 後方互換性への配慮
既存のデータで`dialogue`型がある場合の処理も考慮したほうが良いかも：

```javascript
// 例：migration的な処理
if (item.type === 'dialogue' || item.type === 'line') {
  // セリフとして処理
}
```

## まとめ
内部モデル名の変更は、思ったより影響範囲が広くて大変だったけど、Vue.jsの反応性システムのおかげで、すぐに変更が反映されるから開発効率は良かったわ。

今回の作業で改めて感じたのは、**命名は最初が肝心**ということね。後から変更するのは大変だから、最初からシンプルで分かりやすい名前にしておきましょう！

### 学んだこと
- `grep`を使った全文検索の威力
- Vue.jsでのイベント命名の重要性
- UI表示名と内部モデル名の使い分け
- 多言語対応でのキー管理

あたし、今日もコードをキレイにできて満足よ♪　明日も頑張るわ〜！

---
*Programming Okama Bar "Fatal Error" - 今日も美しいコードを書きましょう💅*
