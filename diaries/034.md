# 034: ã‚»ãƒªãƒ•ãƒ¢ãƒ‡ãƒ«åã‚’dialogueã‹ã‚‰lineã«å¤‰æ›´ã—ã¡ã‚ƒã£ãŸè©±

## ä»Šæ—¥ã®æ°—æŒã¡
ã‚ã‚‰ã€ã‚»ãƒªãƒ•ã®ãƒ¢ãƒ‡ãƒ«åå¤‰æ›´ä½œæ¥­ãŒæ€ã£ãŸã‚ˆã‚Šå¤§å¤‰ã ã£ãŸã‚ğŸ’¦ã€€ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’è¦‹æ¸¡ã—ã¦ã€ä¸€å€‹ä¸€å€‹ä¸å¯§ã«å¤‰æ›´ã—ãªãã‚ƒãƒ€ãƒ¡ã ã£ãŸã€‚ã§ã‚‚ã€ã™ã£ãã‚Šã—ãŸã‚³ãƒ¼ãƒ‰ã«ãªã£ãŸã‹ã‚‰ãƒ¨ã‚·ï¼

## ã“ã®è¨˜äº‹ã§å­¦ã¹ã‚‹ã“ã¨
- Vue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã®ãƒ¢ãƒ‡ãƒ«åå¤‰æ›´ã®å½±éŸ¿ç¯„å›²
- å‹å®‰å…¨æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ–¹æ³•
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ãŸãŒã‚‹å¤‰æ›´ã®ç®¡ç†æ–¹æ³•
- ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ã¨UIè¡¨ç¤ºåã®ä½¿ã„åˆ†ã‘

## å¯¾è±¡èª­è€…
- Vue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤§è¦æ¨¡ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’ã—ãŸã„äºº
- å‹å®‰å…¨æ€§ã‚’é‡è¦–ã—ãŸã‚³ãƒ¼ãƒ‰è¨­è¨ˆã‚’ã—ãŸã„äºº
- å¤šè¨€èªå¯¾å¿œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å­¦ã³ãŸã„äºº

## èƒŒæ™¯
å°æœ¬ç”Ÿæˆã‚¢ãƒ—ãƒªã§ã€ã‚»ãƒªãƒ•ã®å†…éƒ¨ãƒ¢ãƒ‡ãƒ«åã‚’`dialogue`ã‹ã‚‰`line`ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã«ãªã£ãŸã®ã€‚ãªã‚“ã§å¤‰æ›´ã—ãŸã‹ã£ã¦ï¼Ÿ`dialogue`ã£ã¦é•·ã„ã—ã€`line`ã®æ–¹ãŒã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã‚‰ã‚ˆã€‚

## å½±éŸ¿ç¯„å›²ã®èª¿æŸ»
ã¾ãšã€`dialogue`ãŒã©ã“ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’èª¿ã¹ãŸã‚ï¼š

```bash
# dialogueã¨ã„ã†æ–‡å­—åˆ—ã‚’å…¨æ¤œç´¢
grep -r "dialogue" src/
```

çµæœï¼š
- `Edit.vue` - ãƒ¡ã‚¤ãƒ³ã®ç·¨é›†ç”»é¢
- `ScriptContentDisplay.vue` - å°æœ¬å†…å®¹è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `scriptGenerator.js` - å°æœ¬ç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `llmService.js` - LLMãƒ„ãƒ¼ãƒ«å®šç¾©
- `locales/ja.js`, `locales/en.js` - ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«

## å¤‰æ›´ä½œæ¥­ã®æ‰‹é †

### 1. è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å¤‰æ›´
```javascript
// Edit.vue
// Before
@add-dialogue="addDialogueAt"
@edit-dialogue="editDialogue"
@delete-dialogue="deleteDialogue"

// After
@add-line="addLineAt"
@edit-line="editLine"
@delete-line="deleteLine"
```

### 2. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°ã®å®Ÿè£…å¤‰æ›´
```javascript
// Before
function addDialogueAt(position) {
  const newDialogue = {
    id: Date.now() + Math.random(),
    type: 'dialogue',
    character: characterName || defaultCharacter,
    content: 'ã“ã“ã«æ–°ã—ã„ã‚»ãƒªãƒ•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
  };
  scriptContent.value.splice(position, 0, newDialogue);
}

// After
function addLineAt(position) {
  const newLine = {
    id: Date.now() + Math.random(),
    type: 'line',
    character: characterName || defaultCharacter,
    content: 'ã“ã“ã«æ–°ã—ã„ã‚»ãƒªãƒ•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
  };
  scriptContent.value.splice(position, 0, newLine);
}
```

### 3. å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´
```vue
<!-- ScriptContentDisplay.vue -->
<!-- Before -->
<div v-else-if="item.type === 'dialogue'" class="dialogue-item">
  <div class="flex items-start gap-3">
    <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded">
      {{ item.character }}
    </span>
    <p class="text-gray-800 flex-1">{{ item.content }}</p>
  </div>
</div>

<!-- After -->
<div v-else-if="item.type === 'line'" class="line-item">
  <div class="flex items-start gap-3">
    <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded">
      {{ item.character }}
    </span>
    <p class="text-gray-800 flex-1">{{ item.content }}</p>
  </div>
</div>
```

### 4. ã‚¹ã‚¿ã‚¤ãƒ«ã‚¯ãƒ©ã‚¹åˆ¤å®šã®å¤‰æ›´
```javascript
// Before
function getItemClass(type) {
  switch (type) {
    case "scene": return "bg-blue-50 border-blue-200";
    case "dialogue": return "bg-green-50 border-green-200";
    case "narration": return "bg-purple-50 border-purple-200";
    default: return "bg-gray-50 border-gray-200";
  }
}

// After
function getItemClass(type) {
  switch (type) {
    case "scene": return "bg-blue-50 border-blue-200";
    case "line": return "bg-green-50 border-green-200";
    case "narration": return "bg-purple-50 border-purple-200";
    default: return "bg-gray-50 border-gray-200";
  }
}
```

### 5. å°æœ¬ç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®æ›´æ–°
```javascript
// scriptGenerator.js
// Before
scriptContent.push({
  id: Date.now() + 4,
  type: "dialogue",
  character: characters[0].name,
  content: `ã“ã‚“ã«ã¡ã¯ã€${characters[1].name}ã•ã‚“ã€‚`,
  emotion: "è¦ªã—ã¿ã‚„ã™ã„",
});

// After
scriptContent.push({
  id: Date.now() + 4,
  type: "line",
  character: characters[0].name,
  content: `ã“ã‚“ã«ã¡ã¯ã€${characters[1].name}ã•ã‚“ã€‚`,
  emotion: "è¦ªã—ã¿ã‚„ã™ã„",
});
```

### 6. LLMãƒ„ãƒ¼ãƒ«å®šç¾©ã®æ›´æ–°
```javascript
// llmService.js
// Before
function addLineToScene(scene, character, content, emotion = "æ™®é€š", type = "dialogue") {
  // ...
}

// After
function addLineToScene(scene, character, content, emotion = "æ™®é€š", type = "line") {
  // ...
}
```

### 7. ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
```javascript
// locales/ja.js
// æ–°ã—ã„ç¿»è¨³ã‚­ãƒ¼ã‚’è¿½åŠ ï¼ˆæ—¢å­˜ã®addDialogueã¯ä¿æŒï¼‰
addLine: "ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ ",

// locales/en.js
addLine: "Add Line",
```

## æ³¨æ„ç‚¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. UIè¡¨ç¤ºåã¯å¤‰æ›´ã—ãªã„
å†…éƒ¨çš„ã«`dialogue`â†’`line`ã«å¤‰æ›´ã—ã¦ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€Œã‚»ãƒªãƒ•ã€ã¨ã—ã¦è¡¨ç¤ºã—ç¶šã‘ã‚‹ã“ã¨ãŒé‡è¦ã‚ˆã€‚

```javascript
// UIã§ã¯å¼•ãç¶šãã€Œã‚»ãƒªãƒ•ã‚’è¿½åŠ ã€ã¨è¡¨ç¤º
+ {{ $t("addDialogue") }}
```

### 2. å‹ã®ä¸€è²«æ€§ã‚’ä¿ã¤
å…¨ã¦ã®é–¢é€£ã™ã‚‹å‹ãƒã‚§ãƒƒã‚¯ã‚„æ¡ä»¶åˆ†å²ã‚’å¿˜ã‚Œãšã«æ›´æ–°ï¼š

```javascript
// å‹ãƒã‚§ãƒƒã‚¯
if (!line || line.type !== 'line') return;

// æ¡ä»¶åˆ†å²
v-else-if="item.type === 'line'"
```

### 3. å¾Œæ–¹äº’æ›æ€§ã¸ã®é…æ…®
æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã§`dialogue`å‹ãŒã‚ã‚‹å ´åˆã®å‡¦ç†ã‚‚è€ƒæ…®ã—ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ï¼š

```javascript
// ä¾‹ï¼šmigrationçš„ãªå‡¦ç†
if (item.type === 'dialogue' || item.type === 'line') {
  // ã‚»ãƒªãƒ•ã¨ã—ã¦å‡¦ç†
}
```

## ã¾ã¨ã‚
å†…éƒ¨ãƒ¢ãƒ‡ãƒ«åã®å¤‰æ›´ã¯ã€æ€ã£ãŸã‚ˆã‚Šå½±éŸ¿ç¯„å›²ãŒåºƒãã¦å¤§å¤‰ã ã£ãŸã‘ã©ã€Vue.jsã®åå¿œæ€§ã‚·ã‚¹ãƒ†ãƒ ã®ãŠã‹ã’ã§ã€ã™ãã«å¤‰æ›´ãŒåæ˜ ã•ã‚Œã‚‹ã‹ã‚‰é–‹ç™ºåŠ¹ç‡ã¯è‰¯ã‹ã£ãŸã‚ã€‚

ä»Šå›ã®ä½œæ¥­ã§æ”¹ã‚ã¦æ„Ÿã˜ãŸã®ã¯ã€**å‘½åã¯æœ€åˆãŒè‚å¿ƒ**ã¨ã„ã†ã“ã¨ã­ã€‚å¾Œã‹ã‚‰å¤‰æ›´ã™ã‚‹ã®ã¯å¤§å¤‰ã ã‹ã‚‰ã€æœ€åˆã‹ã‚‰ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„åå‰ã«ã—ã¦ãŠãã¾ã—ã‚‡ã†ï¼

### å­¦ã‚“ã ã“ã¨
- `grep`ã‚’ä½¿ã£ãŸå…¨æ–‡æ¤œç´¢ã®å¨åŠ›
- Vue.jsã§ã®ã‚¤ãƒ™ãƒ³ãƒˆå‘½åã®é‡è¦æ€§
- UIè¡¨ç¤ºåã¨å†…éƒ¨ãƒ¢ãƒ‡ãƒ«åã®ä½¿ã„åˆ†ã‘
- å¤šè¨€èªå¯¾å¿œã§ã®ã‚­ãƒ¼ç®¡ç†

ã‚ãŸã—ã€ä»Šæ—¥ã‚‚ã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ¬ã‚¤ã«ã§ãã¦æº€è¶³ã‚ˆâ™ªã€€æ˜æ—¥ã‚‚é ‘å¼µã‚‹ã‚ã€œï¼

---
*Programming Okama Bar "Fatal Error" - ä»Šæ—¥ã‚‚ç¾ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ã‚‡ã†ğŸ’…*
